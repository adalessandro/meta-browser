From 30e55a5587bf5183c8bf7211bbe7e93cdf45ab98 Mon Sep 17 00:00:00 2001
From: Alexandros Frantzis <alexandros.frantzis@collabora.com>
Date: Mon, 7 Oct 2024 10:16:20 +0300
Subject: [PATCH 07/14] media/gpu/v4l2: Use the proper image width for v4l2
 image processor configuration

---
 media/gpu/v4l2/v4l2_image_processor_backend.cc | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/media/gpu/v4l2/v4l2_image_processor_backend.cc b/media/gpu/v4l2/v4l2_image_processor_backend.cc
index 70ad84a409..a1cdf35a7f 100644
--- a/media/gpu/v4l2/v4l2_image_processor_backend.cc
+++ b/media/gpu/v4l2/v4l2_image_processor_backend.cc
@@ -520,7 +520,7 @@ void V4L2ImageProcessorBackend::ProcessJobs() {
     if (!input_queue_->IsStreaming()) {
       const FrameResource& input_frame =
           *(input_job_queue_.front()->input_frame.get());
-      const gfx::Size input_buffer_size(input_frame.stride(0),
+      const gfx::Size input_buffer_size(input_frame.coded_size().width(),
                                         input_frame.coded_size().height());
       if (!ReconfigureV4L2Format(input_buffer_size,
                                  V4L2_BUF_TYPE_VIDEO_OUTPUT_MPLANE)) {
@@ -534,7 +534,7 @@ void V4L2ImageProcessorBackend::ProcessJobs() {
         !output_queue_->IsStreaming()) {
       const FrameResource& output_frame =
           *(input_job_queue_.front()->output_frame.get());
-      const gfx::Size output_buffer_size(output_frame.stride(0),
+      const gfx::Size output_buffer_size(output_frame.coded_size().width(),
                                          output_frame.coded_size().height());
       if (!ReconfigureV4L2Format(output_buffer_size,
                                  V4L2_BUF_TYPE_VIDEO_CAPTURE_MPLANE)) {
-- 
2.45.2

